# 股票搜索功能修复测试指南

## 修复内容总结

### 问题根因
后端API返回的数据字段名与前端期望不匹配：
- **后端返回**: `{"code": "xxx", "name": "xxx"}`
- **前端期望**: `{"stock_code": "xxx", "stock_name": "xxx", "match_type": "xxx"}`

### 修复方案
修改后端`/api/stock_search`端点的响应格式，使字段名与前端TypeScript类型定义一致。

## 测试步骤

### 1. 确认服务运行状态
```bash
# 后端服务应该在 http://localhost:5000 运行
# 前端服务应该在 http://localhost:3000 运行
```

### 2. 测试未登录用户体验
1. 打开浏览器访问 `http://localhost:3000`
2. 在演示模式下点击"添加股票"按钮
3. **预期结果**: 看到黄色警告框"请先登录并配置Tushare Token后再使用股票搜索功能"
4. 搜索框应该被禁用（灰色背景）

### 3. 测试登录用户体验
1. 注册新用户或登录现有账户
2. 登录后点击"添加股票"按钮
3. 在搜索框中输入股票关键词，如：
   - "东莞控股"
   - "平安银行"
   - "000001" 
   - "600036"

#### 预期结果：
- **如果未配置Tushare Token**: 显示错误"请先在用户设置中配置Tushare Token"
- **如果已配置Token**: 显示搜索结果下拉列表，包含：
  - 股票名称
  - 股票代码
  - 匹配类型标签（"代码"或"名称"）

### 4. 验证完整流程
1. 登录用户
2. 前往"用户设置"配置有效的Tushare Token
3. 返回仪表盘，点击"添加股票"
4. 搜索"东莞控股"
5. 从下拉列果中选择目标股票
6. 设置上限和下限阈值
7. 点击"添加到关注列表"

**预期结果**: 股票成功添加到关注列表

## 调试信息

### 后端日志检查
后端现在会输出详细的调试日志，包括：
```
=== 股票搜索API调用 ===
搜索关键词: 东莞控股
结果限制: 15
用户配置获取成功，Tushare Token: 已配置
调用股票搜索服务...
搜索服务返回: success=True, 结果数量=X
格式化结果完成，返回 X 个结果
=== 股票搜索API成功结束 ===
```

### 前端网络请求检查
1. 打开浏览器开发者工具（F12）
2. 切换到"Network"标签
3. 执行搜索操作
4. 查看`/api/stock_search`请求：
   - 请求状态应该是200 OK
   - 响应格式应该是：
   ```json
   {
     "query": "东莞控股",
     "count": X,
     "results": [
       {
         "stock_code": "000828.SZ",
         "stock_name": "东莞控股",
         "match_type": "name"
       }
     ],
     "message": "找到 X 个匹配结果"
   }
   ```

## 常见问题排查

### 问题1: 搜索框被禁用
**原因**: 用户未登录
**解决**: 点击登录按钮进行身份认证

### 问题2: 提示"请先在用户设置中配置Tushare Token"
**原因**: 用户已登录但未配置API Token
**解决**: 
1. 前往"用户设置"页面
2. 在"Tushare配置"部分填入有效Token
3. 保存配置

### 问题3: 搜索无结果或网络错误
**可能原因**:
- Tushare Token无效
- 网络连接问题
- 后端服务未启动
- API调用频率限制

**排查步骤**:
1. 检查后端控制台日志
2. 检查浏览器开发者工具Network标签
3. 验证Tushare Token有效性

### 问题4: 搜索结果格式错误
**检查**: 确认后端API响应字段名是否正确：
- ✅ `stock_code`（不是`code`）
- ✅ `stock_name`（不是`name`）
- ✅ `match_type`

## 成功验证标准

✅ 未登录用户看到明确的登录提示
✅ 登录用户可以正常搜索股票
✅ 搜索结果正确显示股票信息
✅ 可以选择股票并设置阈值
✅ 股票成功添加到关注列表
✅ 错误信息清晰易懂

---

**如果以上测试都通过，说明股票搜索功能已经完全修复！** 🎉 